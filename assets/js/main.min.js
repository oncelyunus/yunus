$(document).ready(function () {
    
  $('.lang-select').select2({
      theme: 'fizy',
      minimumResultsForSearch: Infinity,
      language: 'tr'
  });

  $('#langSelector').change(function() {
      var newLang = $(this).val();
      var parameters = window.location.search.substring(1);

      if (!parameters) {
          getParameter = '';
      }else {
          getParameter = "?"+parameters;
      }
      window.location.replace(newLang+'.html'+getParameter);
  });

    const mainBtn = document.getElementById("main-button");
    const downloadBtn = document.getElementById("download-btn");
    const openInAppBtn = document.getElementById("open-in-app-btn");
    const closeModalBtn = document.getElementById("close-modal-btn");
    const modal = $("#modal");


    const isMobile = () =>
        !!(navigator.userAgent.match(/Android/i)
            || navigator.userAgent.match(/webOS/i)
            || navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i)
            || navigator.userAgent.match(/BlackBerry/i)
            || navigator.userAgent.match(/Windows Phone/i));

    const isAndroid = () => !!(navigator.userAgent.match(/Android/i));

    const isIOS = () =>
        !!(navigator.userAgent.match(/iPhone/i)
            || navigator.userAgent.match(/iPad/i)
            || navigator.userAgent.match(/iPod/i));

    const redirectToMarket = () => {
        if (isIOS()) {
            window.location.href = "https://itunes.apple.com/en/app/fizy-music-video/id404239912?mt=8"
        }
        if (isAndroid()) {
            window.location.href = "https://play.google.com/store/apps/details?id=com.turkcell.gncplay&hl=en"
        }
    };

    const redirectToFizy = () => {
        window.location.href = "http://play.fizy.com/"
    };

    const openMobileApp = () => {
        const isDocumentHidden = () => document.hidden || document.visibilityState === 'hidden' || document['webkitHidden'];
        let timeoutId;
        const docVisibilityChangeListener = () => {
            if (isDocumentHidden()) { // We have successfully switched to mobile Fizy app.
                clearTimeout(timeoutId); // So we no longer need to get redirected to the market.
            }
        };

        // Set fallback timeout: if there is no mobile Fizy app installed - redirect to the market.
        timeoutId = setTimeout(() => {
            document.removeEventListener('visibilitychange', docVisibilityChangeListener);
            
            if (!isDocumentHidden()) {
                redirectToMarket();
            } else {
                window.location.href = `fizy://listen.fizy.com/timeline`;
            }
        }, 750);

        // Track document visibility changes.
        document.addEventListener('visibilitychange', docVisibilityChangeListener);

        // Try to open mobile Fizy app.
        // const mobilePathQuery = location.pathname.startsWith('/error') ?
        //     '' :
        //     `${location.pathname}${location.search}`;
        
    };

    const onOpenModal = () => {
        modal.fadeIn();
    }

    const onCloseModal = () => {
        modal.fadeOut();
    };

    const buttonHandler = () => {
        if (isMobile()) {
            onOpenModal();
        } else {
            redirectToFizy();
        }
    };



    openInAppBtn.addEventListener("click", openMobileApp);
    downloadBtn.addEventListener("click", redirectToMarket);
    closeModalBtn.addEventListener("click", onCloseModal);
    mainBtn.addEventListener("click", buttonHandler);


});

$(window).on('load', function() {
  $(".loader").fadeOut("slow");
  $(".page-wrapper").css("visibility","visible");
});